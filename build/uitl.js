"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof2=require("babel-runtime/helpers/typeof"),_typeof3=_interopRequireDefault(_typeof2),_keys=require("babel-runtime/core-js/object/keys"),_keys2=_interopRequireDefault(_keys);exports.getOptToString=getOptToString,exports.checkOptType=checkOptType,exports.checkOptObjType=checkOptObjType,exports.expressionQuery=expressionQuery,exports.sortSelectSql=sortSelectSql,exports.handleInsertData=handleInsertData;var _sqlstring=require("sqlstring"),_sqlstring2=_interopRequireDefault(_sqlstring);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getOptToString(n){var r,c,p,o="",e=Object.prototype.toString.call(n);return"[object Object]"===e?(r=n._type&&n._type.toUpperCase()||"AND",c=n._type&&n._type.trim()?1:0,(p=(0,_keys2.default)(n)).forEach(function(e,t){"_type"!==e&&("object"===(0,_typeof3.default)(n[e])?t===p.length-1-c?o+=""+checkOptObjType(e,n[e]):o=o+(checkOptObjType(e,n[e])+" ")+r+" ":t===p.length-1-c?o+=e+"="+checkOptType(n[e]):o=o+(e+"="+checkOptType(n[e]))+" "+r+" ")})):"[object Array]"===e&&n.forEach(function(r,e){var c="",t=0,p=r._type&&r._type.toUpperCase()||"AND",a=r._nexttype||"AND",t=r._type&&r._type.trim()?t+1:t;t=r._nexttype&&r._nexttype.trim()?t+1:t,(0,_keys2.default)(r).forEach(function(e,t){"_type"!==e&&"_nexttype"!==e&&(c?"object"===(0,_typeof3.default)(r[e])?c+=p+" "+checkOptObjType(e,r[e]):c=c+(p+" "+e+"="+checkOptType(r[e]))+" ":c="object"===(0,_typeof3.default)(r[e])?""+checkOptObjType(e,r[e]):e+"="+checkOptType(r[e])+" ")}),c=e===n.length-1?"("+c+")":"("+c+") "+a.toUpperCase(),o=o+" "+c}),o}function checkOptType(e,t,r,c){var p=void 0;switch(Object.prototype.toString.call(e)){case"[object String]":e=e.trim(),e=_sqlstring2.default.escape(e),p=r&&c&&-1<e.indexOf(t)&&e.match(/\+|-|\*|\/|%/)?e.slice(1,-1):""+e;break;case"[object Boolean]":case"[object Number]":p=e;break;default:p=_sqlstring2.default.escape(e)}return p}function checkOptObjType(c,p){var a,n,o="";return"[object Object]"===Object.prototype.toString.call(p)?(a=(0,_keys2.default)(p),n=p._type&&p._type.trim()?1:0,a.forEach(function(e,t){var r;"_type"!==e&&(r=p._type||"AND",o+=expressionQuery(c,e,p[e],r.toUpperCase(),t===a.length-1-n))})):o=c+"="+p,"("+o+") "}function expressionQuery(e,t,r,c,p){var a="";switch(t.toUpperCase()){case"EQ":a="("+e+"="+checkOptType(r)+")";break;case"NEQ":a="("+e+"<>"+checkOptType(r)+")";break;case"GT":a="("+e+">"+checkOptType(r)+")";break;case"EGT":a="("+e+">="+checkOptType(r)+")";break;case"LT":a="("+e+"<"+checkOptType(r)+")";break;case"ELT":a="("+e+"<="+checkOptType(r)+")";break;case"LIKE":a="("+e+" LIKE "+checkOptType(r)+")";break;case"NOTLIKE":a="("+e+" NOT LIKE "+checkOptType(r)+")";break;case"BETWEEN":a="("+e+" BETWEEN "+r.replace(","," AND ")+")";break;case"NOTBETWEEN":a="("+e+" NOT BETWEEN "+r.replace(","," AND ")+")";break;case"IN":a="("+e+" IN ("+r+"))";break;case"NOTIN":a="("+e+" NOT IN ("+r+"))";break;default:a="("+e+"="+checkOptType(r)+")"}return p?a+" ":a+" "+c+" "}function sortSelectSql(e){e=e||{};(e.count||e.max||e.min||e.avg||e.sum)&&(t=(e.count?","+e.count:"")+(e.max?","+e.max:"")+(e.min?","+e.min:"")+(e.avg?","+e.avg:"")+(e.sum?","+e.sum:""),e.count=e.max=e.min=e.avg=e.sum="",e.field?e.field=e.field+t:e.field=t.substring(1)),e.field||(e.field="*"),e.table&&(e.table="FROM "+e.table),e.where&&(e.where="WHERE "+e.where);var t=(0,_keys2.default)(e),c=[],p=["union","distinct","field","count","max","min","avg","sum","table","alias","where","group","having","order","limit","page","comment"];return t.forEach(function(r,e){p.forEach(function(e,t){r===e&&(c[t]=r)})}),{sortkeys:c,result:e}}function sortArray(e){for(var t=[],r=(0,_keys2.default)(e[0]),c=1;c<e.length;c++)for(var p=0;p<r.length;p++)(0,_keys2.default)(e[c]).includes(r[p])||r.splice(p,1);for(var a=0;a<e.length;a++){for(var n={},o=0;o<r.length;o++)n[[r[o]]]=e[a][r[o]];t.push(n)}return t}function handleInsertData(e){if(!e)return"";Array.isArray(e)&&1===e.length&&(e=e[0]);var t="",r="";if(Array.isArray(e)){e=sortArray(e),t=(0,_keys2.default)(e[0]).toString();for(var c=0;c<e.length;c++){var p,a="";for(p in e[c])a=a?a+","+checkOptType(e[c][p]):checkOptType(e[c][p]);r+="("+a+"),"}r=r.slice(0,-1)}else{for(var n in e)t=t?t+","+n:n,r=r?r+","+checkOptType(e[n]):checkOptType(e[n]);r="("+r+")"}return"("+t+") VALUES "+r}